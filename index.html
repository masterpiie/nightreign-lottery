<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>黑夜君臨 角色抽選</title>

<style>
/* -------------------------
   基本樣式
------------------------- */
body{
    margin:0;
    background:#000;
    color:#fff;
    text-align:center;
    font-family:Arial, Helvetica, sans-serif;
}

h1{
    margin-top:20px;
}

/* 容器 */
.container{
    display:flex;
    justify-content:center;
    gap:30px;
    margin-top:40px;
    flex-wrap:wrap;
}

/* 抽選框基礎樣式 */
.box{
    display:flex;
    align-items:center;
    justify-content:center;
    border:6px solid;
    border-radius:15px;
}

/* 邊框顏色與陰影 */
.red{border-color:#ff3b3b; box-shadow:0 0 20px #ff3b3b;}
.green{border-color:#00ff99; box-shadow:0 0 20px #00ff99;}
.blue{border-color:#00ccff; box-shadow:0 0 20px #00ccff;}

img{
    object-fit:cover;
    border-radius:10px;
}

/* 桌機尺寸 */
@media (min-width:769px){
    .box{width:290px; height:420px;}
    img{width:270px; height:400px;}
}

/* 手機尺寸 */
@media (max-width:768px){
    .box{width:100px; height:100px;}
    img{width:80px; height:80px;}
}

/* 抽選按鈕 */
.buttons{
    margin-top:40px;
}

button{
    padding:12px 25px;
    font-size:18px;
    margin:10px;
    cursor:pointer;
    border:none;
    border-radius:8px;
}

.repeat{background:#444;color:white;}
.unique{background:#ffcc00;color:black;}

button:hover{
    opacity:0.8;
}
</style>
</head>

<body>

<!-- 標題，暗金色字 -->
<h1>Let me <span style="color:#b8860b;">make your choice</span> for you &#x2764;</h1>

<!-- 抽選框 -->
<div class="container">
    <div class="box red">
        <img id="red" 
             src="images/libra.png" 
             data-large="images/1.png" 
             data-small="images/small/1.png"
             data-placeholder-large="images/libra.png" 
             data-placeholder-small="images/small/libra.png">
    </div>
    <div class="box green">
        <img id="green" 
             src="images/libra.png" 
             data-large="images/2.png" 
             data-small="images/small/2.png"
             data-placeholder-large="images/libra.png" 
             data-placeholder-small="images/small/libra.png">
    </div>
    <div class="box blue">
        <img id="blue" 
             src="images/libra.png" 
             data-large="images/3.png" 
             data-small="images/small/3.png"
             data-placeholder-large="images/libra.png" 
             data-placeholder-small="images/small/libra.png">
    </div>
</div>

<!-- 按鈕 -->
<div class="buttons">
    <button class="repeat" onclick="start(true)">抽選（可重複）</button>
    <button class="unique" onclick="start(false)">抽選（不重複）</button>
</div>

<!-- 抽完才出現的文字 -->
<h1 id="itsdone" style="display:none;">It is done.</h1>

<script>
// -------------------------
// 圖片資料
// -------------------------

const charactersLarge = [
    "images/1.png","images/2.png","images/3.png","images/4.png","images/5.png",
    "images/6.png","images/7.png","images/8.png","images/9.png","images/10.png"
];

const charactersSmall = [
    "images/small/1.png","images/small/2.png","images/small/3.png","images/small/4.png","images/small/5.png",
    "images/small/6.png","images/small/7.png","images/small/8.png","images/small/9.png","images/small/10.png"
];

let running = false; // 是否正在抽選

// -------------------------
// 工具函式
// -------------------------

function getRandom(arr){
    return arr[Math.floor(Math.random()*arr.length)];
}

function isMobile() {
    return window.innerWidth <= 768;
}

// 取得抽選池
function getPool() {
    return isMobile() ? [...charactersSmall] : [...charactersLarge];
}

// -------------------------
// 抽選動畫
// -------------------------
function spin(boxId, duration, pool){
    return new Promise(resolve=>{
        let delay = 60;
        let elapsed = 0;

        function roll(){
            let pick = getRandom(pool);
            document.getElementById(boxId).src = pick;
            elapsed += delay;

            if(elapsed < duration){
                delay += 8; // 減速效果
                setTimeout(roll, delay);
            }else{
                resolve(pick);
            }
        }

        roll();
    });
}

// -------------------------
// 抽選主程式
// -------------------------
async function start(allowDuplicate){
    if(running) return;
    running = true;

    const isMob = isMobile();

    // 清空畫面，使用桌機/手機占位圖
    document.getElementById("red").src = isMob ? 
        document.getElementById("red").dataset.placeholderSmall : 
        document.getElementById("red").dataset.placeholderLarge;
    document.getElementById("green").src = isMob ? 
        document.getElementById("green").dataset.placeholderSmall : 
        document.getElementById("green").dataset.placeholderLarge;
    document.getElementById("blue").src = isMob ? 
        document.getElementById("blue").dataset.placeholderSmall : 
        document.getElementById("blue").dataset.placeholderLarge;

    document.getElementById("itsdone").style.display = "none";

    await new Promise(r => setTimeout(r, 300));

    let pool = getPool();

    // 逐個抽選
    let red = await spin("red",1500,pool);
    if(!allowDuplicate) pool = pool.filter(x=>x!==red);

    let green = await spin("green",2300,pool);
    if(!allowDuplicate) pool = pool.filter(x=>x!==green);

    await spin("blue",3100,pool);

    document.getElementById("itsdone").style.display = "block";

    running = false;
}

// -------------------------
// 頁面載入時自動切換初始占位圖
// -------------------------
window.addEventListener("load", ()=>{
    const isMob = isMobile();
    document.getElementById("red").src = isMob ? 
        document.getElementById("red").dataset.placeholderSmall : 
        document.getElementById("red").dataset.placeholderLarge;
    document.getElementById("green").src = isMob ? 
        document.getElementById("green").dataset.placeholderSmall : 
        document.getElementById("green").dataset.placeholderLarge;
    document.getElementById("blue").src = isMob ? 
        document.getElementById("blue").dataset.placeholderSmall : 
        document.getElementById("blue").dataset.placeholderLarge;
});
</script>

</body>
</html>

